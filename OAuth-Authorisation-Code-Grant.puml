@startuml

participant "Resource Owner" as resource_owner
participant "User-Agent" as user_agent
participant "Client" as client
participant "Authorisation Server" as authorisation_server

client -> user_agent: Client starts flow by redirecting \n resource owner's user-agent to the \n authorisation endpoint as \n defined previously. Includes its \n client Id, scope, state and redirection \n URI, so the authorisation server \n knows where to go back to.
user_agent -> authorisation_server: User-agent now goes to the authorisation server, passing \n the query parameters as described above.
authorisation_server -> user_agent: Resource owner is authenticated by authorisation server via \n the user-agent. The authorisation server also asks for the \n resource owner's authorisation.
user_agent -> resource_owner: Gets the resource owner \n to authenticate and grant \n access.
resource_owner -> user_agent: Authenticates and grants access.
user_agent -> authorisation_server: Facilitates resource owner's authentication and access granting.
authorisation_server -> user_agent: Redirects back to the client using the redirection URI provided \n earlier. Passes on a new authorisation code generated by the \n authorisation server.
user_agent -> client: Is redirected back to the client with the \n query parameters
client -> authorisation_server: Requests an access token \n from the authorisation server, \n authenticating and sending the \n redirect URI for verification.
authorisation_server -> client: Validates client, matches \n redirect URI to the one from \n the earlier step and issues \n access (and potentially) refresh \n tokens.

@enduml